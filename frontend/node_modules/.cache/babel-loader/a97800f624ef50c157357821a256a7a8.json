{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useRef,useEffect}from\"react\";import\"@tensorflow/tfjs-core\";import\"@tensorflow/tfjs-backend-webgl\";import\"@tensorflow/tfjs-backend-wasm\";import*as poseDetection from\"@tensorflow-models/pose-detection\";import Webcam from\"react-webcam\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var videoDim={width:1280,height:720};var rafId;var camera,detector;export default function Camera(){var webcamRef=useRef(null);var canvasRef=useRef(null);function setupCamera(){camera=webcamRef.current;}function setupDetector(){return _setupDetector.apply(this,arguments);}function _setupDetector(){_setupDetector=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var model,detectorConfig;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:model=poseDetection.SupportedModels.MoveNet;detectorConfig={modelType:poseDetection.movenet.modelType.MULTIPOSE_LIGHTNING,minPoseScore:0.2,enableTracking:true};_context.next=4;return poseDetection.createDetector(model,detectorConfig);case 4:detector=_context.sent;case 5:case\"end\":return _context.stop();}}},_callee);}));return _setupDetector.apply(this,arguments);}function detect(_x){return _detect.apply(this,arguments);}function _detect(){_detect=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(detector){var video,videoWidth,videoHeight,poses;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(typeof camera===\"undefined\"||camera===null)){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:if(!(camera.video.readyState!==4)){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:if(detector){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:video=camera.video;videoWidth=video.videoWidth;videoHeight=video.videoHeight;camera.video.width=videoWidth;camera.video.height=videoHeight;_context2.next=13;return detector.estimatePoses(video);case 13:poses=_context2.sent;console.log(poses);case 15:case\"end\":return _context2.stop();}}},_callee2);}));return _detect.apply(this,arguments);}function renderResult(){return _renderResult.apply(this,arguments);}function _renderResult(){_renderResult=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return detect(detector);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return _renderResult.apply(this,arguments);}function renderPrediction(){return _renderPrediction.apply(this,arguments);}function _renderPrediction(){_renderPrediction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return renderResult();case 2:rafId=requestAnimationFrame(renderPrediction);if(rafId){console.log(\"using rafId\");}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return _renderPrediction.apply(this,arguments);}function run(){return _run.apply(this,arguments);}function _run(){_run=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setupCamera();_context5.next=3;return setupDetector();case 3:renderPrediction();case 4:case\"end\":return _context5.stop();}}},_callee5);}));return _run.apply(this,arguments);}useEffect(function(){run();});return/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(Webcam,{ref:webcamRef,style:{position:'absolute',width:videoDim.width,height:videoDim.height,left:0,top:0}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{position:'absolute',width:videoDim.width,height:videoDim.height,left:0,top:0}})]});}","map":{"version":3,"sources":["/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/src/components/Camera.js"],"names":["React","useRef","useEffect","poseDetection","Webcam","videoDim","width","height","rafId","camera","detector","Camera","webcamRef","canvasRef","setupCamera","current","setupDetector","model","SupportedModels","MoveNet","detectorConfig","modelType","movenet","MULTIPOSE_LIGHTNING","minPoseScore","enableTracking","createDetector","detect","video","readyState","videoWidth","videoHeight","estimatePoses","poses","console","log","renderResult","renderPrediction","requestAnimationFrame","run","position","left","top"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect } from \"react\"\nimport \"@tensorflow/tfjs-core\"\nimport \"@tensorflow/tfjs-backend-webgl\"\nimport \"@tensorflow/tfjs-backend-wasm\"\nimport * as poseDetection from \"@tensorflow-models/pose-detection\"\nimport Webcam from \"react-webcam\"\n\nconst videoDim = {\n    width: 1280,\n    height: 720\n}\n\nlet rafId\nlet camera, detector\n\nexport default function Camera() {\n    const webcamRef = useRef(null)\n    const canvasRef = useRef(null)\n\n    function setupCamera() {\n        camera = webcamRef.current\n    }\n\n    async function setupDetector() {\n        const model = poseDetection.SupportedModels.MoveNet\n        const detectorConfig = {\n            modelType: poseDetection.movenet.modelType.MULTIPOSE_LIGHTNING,\n            minPoseScore: 0.2,\n            enableTracking: true\n        }\n        detector = await poseDetection.createDetector(model, detectorConfig)\n    }\n\n\n    async function detect(detector) {\n        if (typeof camera === \"undefined\" || camera === null) return\n        if (camera.video.readyState !== 4) return\n        if (!detector) return\n\n        const video = camera.video\n        const videoWidth = video.videoWidth\n        const videoHeight = video.videoHeight\n\n        camera.video.width = videoWidth\n        camera.video.height = videoHeight\n\n        const poses = await detector.estimatePoses(video)\n        console.log(poses);\n    }\n\n    async function renderResult() {\n        await detect(detector)\n    }\n\n    async function renderPrediction() {\n        await renderResult()\n        rafId = requestAnimationFrame(renderPrediction)\n        if (rafId) {\n            console.log(\"using rafId\");\n        }\n    }\n\n    async function run() {\n        setupCamera()\n        await setupDetector()\n        renderPrediction()\n    }\n\n    useEffect(() => {\n        run()\n    })\n\n    return (\n        <div style={{ position: 'relative' }}>\n            <Webcam\n                ref={webcamRef}\n                style={{\n                    position: 'absolute',\n                    width: videoDim.width,\n                    height: videoDim.height,\n                    left: 0,\n                    top: 0,\n                }}\n            />\n            <canvas\n                ref={canvasRef}\n                style={{\n                    position: 'absolute',\n                    width: videoDim.width,\n                    height: videoDim.height,\n                    left: 0,\n                    top: 0,\n                }} />\n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}