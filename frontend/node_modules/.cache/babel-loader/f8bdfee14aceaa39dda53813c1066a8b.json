{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useRef,useEffect}from\"react\";import\"@tensorflow/tfjs-core\";import\"@tensorflow/tfjs-backend-webgl\";import\"@tensorflow/tfjs-backend-wasm\";import*as poseDetection from\"@tensorflow-models/pose-detection\";import Webcam from\"react-webcam\";import{drawResults}from\"../utils/drawUtils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var videoDim={width:1280,height:720};var rafId;var camera,detector;var ctx;export default function Camera(){var webcamRef=useRef(null);var canvasRef=useRef(null);function setupCamera(){camera=webcamRef.current;ctx=canvasRef.current.getContext(\"2d\");}function setupDetector(){return _setupDetector.apply(this,arguments);}function _setupDetector(){_setupDetector=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var model,detectorConfig;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:model=poseDetection.SupportedModels.MoveNet;detectorConfig={modelType:poseDetection.movenet.modelType.MULTIPOSE_LIGHTNING,minPoseScore:0.2,enableTracking:true};_context.next=4;return poseDetection.createDetector(model,detectorConfig);case 4:detector=_context.sent;case 5:case\"end\":return _context.stop();}}},_callee);}));return _setupDetector.apply(this,arguments);}function detect(_x){return _detect.apply(this,arguments);}function _detect(){_detect=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(detector){var video,videoWidth,videoHeight,poses;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(typeof camera===\"undefined\"||camera===null)){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:if(!(camera.video.readyState!==4)){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:if(detector){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:video=camera.video;videoWidth=video.videoWidth;videoHeight=video.videoHeight;camera.video.width=videoWidth;camera.video.height=videoHeight;_context2.next=13;return detector.estimatePoses(video);case 13:poses=_context2.sent;console.log(\"found poses:\");console.log(poses);drawCanvas(poses,videoWidth,videoHeight,canvasRef);case 17:case\"end\":return _context2.stop();}}},_callee2);}));return _detect.apply(this,arguments);}function drawCanvas(poses,videoWidth,videoHeight,canvas){var ctx=canvas.current.getContext(\"2d\");canvas.current.videoWidth=videoWidth;canvas.current.videoHeight=videoHeight;drawResults(poses,ctx,0);}function renderResult(){return _renderResult.apply(this,arguments);}function _renderResult(){_renderResult=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(detector){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:_context3.next=4;return detect(detector);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _renderResult.apply(this,arguments);}function renderPrediction(){return _renderPrediction.apply(this,arguments);}function _renderPrediction(){_renderPrediction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return renderResult();case 2:rafId=requestAnimationFrame(renderPrediction);if(rafId){}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return _renderPrediction.apply(this,arguments);}function run(){return _run.apply(this,arguments);}function _run(){_run=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setupCamera();_context5.next=3;return setupDetector();case 3:renderPrediction();case 4:case\"end\":return _context5.stop();}}},_callee5);}));return _run.apply(this,arguments);}useEffect(function(){console.log(\"LOADING ...\");run();console.log(\"DONE LOADING.\");});return/*#__PURE__*/_jsxs(\"div\",{style:{position:\"relative\"},children:[/*#__PURE__*/_jsx(Webcam,{ref:webcamRef,mirrored:true,style:{position:\"absolute\",width:videoDim.width,height:videoDim.height,left:0,top:0}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{position:\"absolute\",width:videoDim.width,height:videoDim.height,left:0,top:0}})]});}","map":{"version":3,"sources":["/Users/alberttian/f21/playground/frontend/fencing-ai-frontend/src/components/Camera.jsx"],"names":["React","useRef","useEffect","poseDetection","Webcam","drawResults","videoDim","width","height","rafId","camera","detector","ctx","Camera","webcamRef","canvasRef","setupCamera","current","getContext","setupDetector","model","SupportedModels","MoveNet","detectorConfig","modelType","movenet","MULTIPOSE_LIGHTNING","minPoseScore","enableTracking","createDetector","detect","video","readyState","videoWidth","videoHeight","estimatePoses","poses","console","log","drawCanvas","canvas","renderResult","renderPrediction","requestAnimationFrame","run","position","left","top"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect } from \"react\";\nimport \"@tensorflow/tfjs-core\";\nimport \"@tensorflow/tfjs-backend-webgl\";\nimport \"@tensorflow/tfjs-backend-wasm\";\nimport * as poseDetection from \"@tensorflow-models/pose-detection\";\nimport Webcam from \"react-webcam\";\nimport { drawResults } from \"../utils/drawUtils\";\n\nconst videoDim = {\n  width: 1280,\n  height: 720,\n};\n\nlet rafId;\nlet camera, detector;\nlet ctx;\n\nexport default function Camera() {\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  function setupCamera() {\n    camera = webcamRef.current;\n    ctx = canvasRef.current.getContext(\"2d\");\n  }\n\n  async function setupDetector() {\n    const model = poseDetection.SupportedModels.MoveNet;\n    const detectorConfig = {\n      modelType: poseDetection.movenet.modelType.MULTIPOSE_LIGHTNING,\n      minPoseScore: 0.2,\n      enableTracking: true,\n    };\n    detector = await poseDetection.createDetector(model, detectorConfig);\n  }\n\n  async function detect(detector) {\n    if (typeof camera === \"undefined\" || camera === null) return;\n    if (camera.video.readyState !== 4) return;\n    if (!detector) return;\n\n    const video = camera.video;\n    const videoWidth = video.videoWidth;\n    const videoHeight = video.videoHeight;\n\n    camera.video.width = videoWidth;\n    camera.video.height = videoHeight;\n\n    const poses = await detector.estimatePoses(video);\n    console.log(\"found poses:\");\n    console.log(poses);\n    drawCanvas(poses, videoWidth, videoHeight, canvasRef);\n  }\n\n  function drawCanvas(poses, videoWidth, videoHeight, canvas) {\n    const ctx = canvas.current.getContext(\"2d\");\n    canvas.current.videoWidth = videoWidth;\n    canvas.current.videoHeight = videoHeight;\n\n    drawResults(poses, ctx, 0);\n  }\n\n  async function renderResult() {\n    if (!detector) return;\n    await detect(detector);\n  }\n\n  async function renderPrediction() {\n    await renderResult();\n    rafId = requestAnimationFrame(renderPrediction);\n    if (rafId) {\n    }\n  }\n\n  async function run() {\n    setupCamera();\n    await setupDetector();\n    renderPrediction();\n  }\n\n  useEffect(() => {\n    console.log(\"LOADING ...\");\n    run();\n    console.log(\"DONE LOADING.\");\n  });\n\n  return (\n    <div style={{ position: \"relative\" }}>\n      <Webcam\n        ref={webcamRef}\n        mirrored\n        style={{\n          position: \"absolute\",\n          width: videoDim.width,\n          height: videoDim.height,\n          left: 0,\n          top: 0,\n        }}\n      />\n      <canvas\n        ref={canvasRef}\n        style={{\n          position: \"absolute\",\n          width: videoDim.width,\n          height: videoDim.height,\n          left: 0,\n          top: 0,\n        }}\n      />\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}